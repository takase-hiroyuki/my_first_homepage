<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最終診断テスト</title>
</head>
<body>
    <h1>LIFF接続テスト</h1>
    <div id="status" style="padding: 15px; border: 2px solid #ccc; background-color: #f0f0f0;">
        1. SDKを待機中...
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    
    <script>
        const statusEl = document.getElementById('status');
        
        // 1秒ごとに状態を更新する診断
        let timer = 0;
        const diag = setInterval(() => {
            timer++;
            if(timer > 5 && statusEl.innerText.includes("初期化実行中")) {
                statusEl.innerText = "5秒経過：まだ返事がありません。IDが正しいか、または通信がブロックされています。";
                clearInterval(diag);
            }
        }, 1000);

        // ページが完全に読み込まれたら実行
        window.addEventListener('load', () => {
            if (typeof liff === 'undefined') {
                statusEl.innerText = "エラー：SDK（sdk.js）が読み込まれていません。";
                return;
            }

            statusEl.innerText = "2. 初期化実行中（ID: 2008802651-ZJlLamw2）...";
            
            liff.init({
                liffId: "2008802651-ZJlLamw2"
            })
            .then(() => {
                clearInterval(diag);
                statusEl.style.backgroundColor = "#e0ffe0";
                statusEl.innerText = "3. ★成功！初期化完了。";
                
                // 成功したら名前を取得してみる
                liff.getProfile().then(p => {
                    statusEl.innerText += "\nこんにちは、" + p.displayName + "さん！";
                });
            })
            .catch((err) => {
                clearInterval(diag);
                statusEl.style.backgroundColor = "#ffe0e0";
                statusEl.innerText = "初期化エラー検知: " + JSON.stringify(err);
            });
        });
    </script>
</body>
</html>
